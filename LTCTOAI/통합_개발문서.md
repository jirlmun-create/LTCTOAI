# AI 기반 장기요양 평가 보고서 생성기: 통합 개발 문서

---

## 프로젝트 개요 및 목표
- **프로젝트명:** AI 기반 장기요양 평가 보고서 생성기
- **목표:** 사용자가 제공하는 PDF 형태의 장기요양 기록 및 법령 자료를 AI로 분석하여, 어르신별 기록을 평가 기준에 맞게 자동 보고서로 생성하는 GUI 애플리케이션 개발

## 주요 기능 및 기술 스택
- GUI 애플리케이션(PC/네트워크 지원)
- Hugging Face 모델 파인튜닝
- 맵리듀스 방식 대용량 분석
- 교차점검 및 자동 보고서 생성
- 대화형 프롬프트 기능(질문/답변)
- Python, Tkinter/PyQt5, PyInstaller, PyMuPDF, transformers, matplotlib, pandas

## 프로젝트 파일 구조
```
/AI_LongTermCare_Reporter/
├── main.py              # 애플리케이션 시작점
├── ui_app.py            # 사용자 인터페이스
├── data_processor.py    # PDF 읽기/추출/구조화
├── model_manager.py     # 모델 관리/파인튜닝
├── report_generator.py  # 보고서 생성/시각화
├── chat_interface.py    # 대화형 기능
├── requirements.txt     # 라이브러리 목록
├── models/              # 모델 저장
├── data/
│   ├── common_docs/     # 공통 자료
│   └── patient_docs/    # 어르신별 자료
└── reports/             # 보고서 저장
```

---

## 단계별 개발 및 기능 설명
### 1단계: 환경 설정 및 UI/UX 개발
- 가상 환경 및 라이브러리 설치
- GUI 메인 윈도우 구현(제목, 폴더 선택, 전문가 영역, 진행바, 결과 출력)
- 네트워크 경로 처리(UNC 지원)
- 실행 파일 생성(PyInstaller)

### 2단계: 데이터 처리 및 모델 관리
- PDF 텍스트 추출 함수: `extract_text_from_pdf(pdf_path)`
- 공통 자료/어르신별 자료 구조화
- AI 모델 로드 및 파인튜닝
- 추가 학습 기능

### 3단계: 분석 로직 및 보고서 생성
- 맵 단계: 개별 분석 스레드, 기록 교차점검
- 리듀스 단계: 결과 통합
- 보고서 콘텐츠 생성(matplotlib 그래프, 누락/감점 항목 명확화)
- PDF 보고서 출력(fpdf/reportlab)

### 4단계: 대화형 프롬프트 기능
- 질문 처리 및 답변 생성(공통 지식, 분석 결과 기반)
- 답변 출력(GUI 결과 영역)

---

# 사용자 시나리오 예시

## 1. 앱 실행 및 초기 설정
- 사용자(사회복지사)가 `AI_LongTermCare_Reporter.exe` 실행
- 최근 사용한 폴더 경로 자동 저장/불러오기(최초 실행 시 최근 경로 표시)
- '공통 자료 폴더 선택' → 최신 법령/고시 PDF 네트워크 폴더 지정
- '어르신 자료 폴더 선택' → 개별 기록 PDF 폴더 선택
- 네트워크 폴더 오류/연결 문제 미리 안내
- 'AI 전문가 영역' 드롭다운에서 '시설 요양원' 선택

## 2. AI 분석 및 보고서 생성
- '분석 시작' 버튼 클릭
- 시스템 동작:
  - 공통 자료 PDF 읽어 '공통 지식 저장소' 메모리 로드(이미 학습된 내용 스킵)
  - 어르신별 기록을 개별 스레드에 할당(맵 단계)
  - 각 스레드에서 AI 모델로 기록 분석 및 교차점검
  - 예시: '체중 변화 기록' 누락, '프로그램 참여 서명' 누락 등 감지
  - 결과 취합(리듀스 단계), 그래프 생성
  - 최종 보고서 PDF 생성 및 화면 출력, reports 폴더 저장
  - 진행바 외에 현재 분석 중인 어르신 이름, 단계별 진행 상황 실시간 표시
  - 오류 발생 시 즉시 알림 및 재시도 옵션 제공
  - 보고서 생성 후 주요 누락/감점 항목 요약/하이라이트 영역 제공
  - 그래프와 함께 감점 예상 항목, 개선 필요 사항 등 평가 결과 요약 표시
  - "보고서 생성이 완료되었습니다." 메시지 표시

## 3. 대화형 기능 활용
- 보고서 확인 중 궁금한 점을 대화형 기능으로 질문
  - 텍스트 입력창에 질문 입력, 자주 묻는 질문 추천/자동완성 기능 제공
- 시스템 동작:
  - 질문을 AI 모델에 전달
  - 공통 지식 참고, 관련 조항 찾아 답변 생성
  - 예시 답변: "고시 제75조의2에 따라, 체중 변화 기록을 1개월에 1회 이상 작성하지 않을 경우 평가 시 감점 요인이 될 수 있습니다..."
  - 답변에 관련 문서 링크, 추가 설명 버튼 등 부가 정보 제공

---

# 개발 세부일정 및 체크리스트

## 개발 세부일정
### 1. 프로젝트 목표 및 역할 분담
- 1일차: 목표 설정, 역할 분담
### 2. 요구사항 정의 및 설계
- 2일차: 기능 목록 작성, 화면/기능 설계
- 3일차: 데이터 흐름, 구조 설계
### 3. 개발 환경 세팅 및 초기화
- 4일차: 환경 설치 및 초기화
- 5일차: 폴더/파일 생성, 버전관리 시작
### 4. 기능별 개발 및 협업
- 6~10일차: 기능 개발
- 11~13일차: 코드 합치기, 충돌 해결, 통합 테스트
### 5. 코드 리뷰 및 개선
- 14일차: 코드 리뷰, 개선점 반영
### 6. 문서화 및 배포 준비
- 15일차: 문서 작성
- 16일차: 배포 논의 및 실제 배포
### 7. 최종 점검 및 회고
- 17일차: 기능 점검, 버그 수정
- 18일차: 회고 및 다음 목표 설정

---

## 개발 진행 체크리스트

### 체크리스트 사용방법
- 각 단계별 항목을 개발 진행 중 수시로 확인
- 완료한 항목에는 ✔ 또는 날짜 표시
- 미완료 항목은 추가 학습, 질문, 협업 등으로 해결
- 프로젝트 회고 시 체크리스트 참고

### 체크리스트
#### 1. 프로젝트 목표 및 역할 분담
- [ ] 프로젝트 목표를 명확히 설정했다
- [ ] 역할(기획, 개발, 문서 등)을 분담했다
#### 2. 요구사항 정의 및 설계
- [ ] 필요한 기능 목록을 작성했다
- [ ] 화면/기능 설계를 완료했다
- [ ] 데이터 흐름 및 구조를 설계했다
#### 3. 개발 환경 세팅 및 초기화
- [ ] IDE, Git 등 개발 환경을 설치했다
- [ ] 프로젝트 초기화 및 폴더/파일 생성했다
- [ ] 버전관리를 시작했다
#### 4. 기능별 개발 및 협업
- [ ] 각자 맡은 기능을 개발했다
- [ ] 코드 합치기 및 충돌 해결을 했다
- [ ] 기능 통합 테스트를 진행했다
#### 5. 코드 리뷰 및 개선
- [ ] 서로의 코드를 리뷰했다
- [ ] 개선점을 논의하고 반영했다
#### 6. 문서화 및 배포 준비
- [ ] 프로젝트 사용법/설치법 문서를 작성했다
- [ ] 배포 방법을 논의하고 실제 배포했다
#### 7. 최종 점검 및 회고
- [ ] 전체 기능을 점검하고 버그를 수정했다
- [ ] 프로젝트 회고 및 느낀 점을 공유했다

---

# 세분화된 파이썬 파일 역할 (표 형식, 진행상태 표시)

| 파일명                | 역할 및 기능 설명                           | 중요도      | 선행 코드/의존성           | 진행상태   |
|----------------------|--------------------------------------------|------------|--------------------------|-----------|
| main.py              | 프로그램 실행 및 전체 흐름 제어             | ★★★★★      | config.py, ui_app.py 등   | ☐ 진행전   |
| config.py            | 환경설정, 경로, 옵션 관리                   | ★★★★★      | -                        | ☐ 진행전   |
| utils.py             | 공통 유틸리티 함수(날짜, 경로 등)           | ★★★★★      | -                        | ☐ 진행전   |
| ui_app.py            | GUI 메인 윈도우 및 이벤트 처리              | ★★★★★      | config.py, utils.py       | ☐ 진행전   |
| data_processor.py    | PDF 읽기/추출/구조화, 데이터 유효성 검사    | ★★★★★      | config.py, utils.py       | ☐ 진행전   |
| model_manager.py     | AI 모델 로드/저장/파인튜닝                  | ★★★★★      | config.py, data_processor.py| ☐ 진행전   |
| report_generator.py  | 보고서 생성, 요약, 시각화, PDF 저장         | ★★★★★      | model_manager.py, data_processor.py, utils.py | ☐ 진행전   |
| chat_interface.py    | 대화형 질문/답변 기능                       | ★★★★☆      | model_manager.py, report_generator.py | ☐ 진행전   |
| error_handler.py     | 오류 발생 시 알림 및 재시도 처리             | ★★★★☆      | -                        | ☐ 진행전   |

---

진행상태(☐ 진행전, ▣ 개발중, ■ 완료)를 직접 표시하며 관리할 수 있습니다.

---

# 사용자 메뉴얼 (초안)

---

## 1. 프로그램 설치 및 실행
- 설치 파일을 다운로드 후 실행하여 설치합니다.
- 바탕화면 또는 시작 메뉴에서 `AI_LongTermCare_Reporter.exe`를 실행합니다.

## 2. 기본 사용법
- 프로그램 실행 후, '공통 자료 폴더'와 '어르신 자료 폴더'를 각각 선택합니다.
- 'AI 전문가 영역'을 선택합니다(예: 시설 요양원).
- '분석 시작' 버튼을 클릭하면 자동으로 보고서가 생성됩니다.
- 생성된 보고서는 화면에 표시되며, `reports` 폴더에 저장됩니다.
- 궁금한 점은 대화형 질문창에 입력 후 '질문' 버튼을 클릭하면 AI가 답변합니다.

## 3. 개인정보 보호(보안)
- 어르신 성명은 가운데 한 글자를 `*`로 표시합니다. (예: 김*수, 박*영)
- 주민번호는 앞 6자리와 뒤 1자리만 보이고, 나머지는 `*`로 처리합니다. (예: 900101-1******)
- 모든 개인정보는 보고서 및 화면 출력 시 자동으로 마스킹 처리됩니다.

## 4. 테스트/품질관리 계획
- 각 주요 기능별로 간단한 테스트 코드를 작성합니다.
  - 예: PDF 추출, 모델 예측, 보고서 생성, 개인정보 마스킹 등
- 테스트는 pytest 등으로 실행하며, 오류 발생 시 즉시 수정합니다.
- 배포 전 체크리스트를 활용해 주요 기능, 개인정보 보호, 문서화 상태를 점검합니다.
- 자동화(CI/CD)는 추후 필요시 도입하며, 초기에는 수동 테스트와 체크리스트 관리로 진행합니다.

---

이 메뉴얼과 계획을 참고하여 초보자도 안전하고 쉽게 프로그램을 사용할 수 있습니다.

---

# 테스트 코드 예시 (pytest) - 주석 자세히 설명

```python
# 파일명: test_pdf_parser.py

# pdf_parser 모듈에서 extract_text_from_pdf 함수를 불러옵니다.
from pdf_parser import extract_text_from_pdf

# 테스트 함수는 반드시 'test_'로 시작해야 pytest가 자동으로 인식합니다.
def test_extract_text_from_pdf():
    # 테스트용 PDF 파일 경로를 지정합니다.
    test_pdf = "sample.pdf"
    # PDF에서 텍스트를 추출하는 함수를 실행합니다.
    result = extract_text_from_pdf(test_pdf)
    # 추출 결과가 문자열(str) 타입인지 확인합니다.
    assert isinstance(result, str)
    # 결과에 특정 키워드(예: '장기요양')가 포함되어 있는지 확인합니다.
    assert "장기요양" in result  # 실제 테스트에서는 적절한 키워드를 사용하세요.
```

# 실행 방법
1. 위 코드를 test_pdf_parser.py 파일로 저장합니다.
2. 터미널에서 아래 명령어를 입력하면 테스트가 자동으로 실행됩니다.
   ```
   pytest
   ```

# 주석을 충분히 달아두면 초보자도 각 코드의 역할과 테스트 과정을 쉽게 이해할 수 있습니다.

---

# 폴더 구조 및 데이터 관리 (최종 정리)

---

## 1. 폴더 구조
```
/AI_LongTermCare_Reporter/
├── main.py
├── ... (기타 코드 파일)
├── data/
│   ├── common_docs/         # 공통 자료 폴더
│   │   ├── 전체/           # 모든 영역에 공통적으로 적용되는 자료
│   │   ├── 시설요양원/     # 시설요양원 전용 자료
│   │   ├── 주간보호/       # 주간보호 전용 자료
│   │   ├── 방문요양/       # 방문요양 전용 자료
│   │   └── 방문간호/       # 방문간호 전용 자료
│   └── patient_docs/       # 어르신별 자료 폴더
│       ├── 시설요양원/     # 시설요양원 어르신별 자료
│       ├── 주간보호/       # 주간보호 어르신별 자료
│       ├── 방문요양/       # 방문요양 어르신별 자료
│       └── 방문간호/       # 방문간호 어르신별 자료
└── reports/                # 보고서 저장 폴더
```

## 2. 데이터 관리 및 활용
- 공통 자료는 `/common_docs/전체/`와 각 영역별 폴더에 구분해 저장합니다.
- 어르신별 자료도 영역별로 `/patient_docs/` 하위에 저장합니다.
- 프로그램은 선택된 전문가 영역에 따라 해당 영역 폴더와 `/전체/` 폴더의 자료를 함께 불러와 분석합니다.
- 데이터 파일은 필요시 추가/수정/삭제하며, 프로그램은 항상 최신 자료로 분석을 진행합니다.

---

이 구조와 관리 방안을 기준으로 폴더를 생성하고 데이터를 운영하면, 혼동 없이 체계적으로 프로젝트를 진행할 수 있습니다.

---

# 실제 사용할 세분화된 파이썬 파일 역할 (최종 정리)

| 파일명                | 역할 및 기능 설명                           | 중요도      | 선행 코드/의존성           | 진행상태   |
|----------------------|--------------------------------------------|------------|--------------------------|-----------|
| main.py              | 프로그램 실행 및 전체 흐름 제어             | ★★★★★      | config.py, ui_app.py 등   | ☐ 진행전   |
| config.py            | 환경설정, 경로, 옵션 관리                   | ★★★★★      | -                        | ☐ 진행전   |
| utils.py             | 공통 유틸리티 함수(날짜, 경로 등)           | ★★★★★      | -                        | ☐ 진행전   |
| ui_app.py            | GUI 메인 윈도우 및 이벤트 처리              | ★★★★★      | config.py, utils.py       | ☐ 진행전   |
| data_processor.py    | PDF 읽기/추출/구조화, 데이터 유효성 검사    | ★★★★★      | config.py, utils.py       | ☐ 진행전   |
| model_manager.py     | AI 모델 로드/저장/파인튜닝                  | ★★★★★      | config.py, data_processor.py| ☐ 진행전   |
| report_generator.py  | 보고서 생성, 요약, 시각화, PDF 저장         | ★★★★★      | model_manager.py, data_processor.py, utils.py | ☐ 진행전   |
| chat_interface.py    | 대화형 질문/답변 기능                       | ★★★★☆      | model_manager.py, report_generator.py | ☐ 진행전   |
| error_handler.py     | 오류 발생 시 알림 및 재시도 처리             | ★★★★☆      | -                        | ☐ 진행전   |

---

# 어르신 자료 저장 방식 (영역별 + 어르신별 폴더)

---

## 1. 폴더 구조 예시
```
/AI_LongTermCare_Reporter/data/patient_docs/
├── 시설요양원/
│   ├── 김*수/      # 어르신별 폴더, 개인정보 마스킹 적용
│   │   ├── 기록1.pdf
│   │   └── 기록2.pdf
│   ├── 박*영/
│   │   └── ...
├── 주간보호/
│   ├── 이*진/
│   │   └── ...
├── 방문요양/
│   └── ...
└── 방문간호/
    └── ...
```

- 각 전문가 영역별 폴더 하위에 어르신 이름(마스킹 적용)으로 폴더를 생성해 자료를 저장합니다.
- 어르신별 폴더에는 해당 어르신의 기록 PDF 파일을 넣습니다.
- 프로그램은 영역 → 어르신별 폴더 → 기록 파일 순으로 자료를 불러와 분석합니다.

---

이 방식으로 관리하면, 어르신별 자료 접근과 개인정보 보호가 모두 용이합니다.
