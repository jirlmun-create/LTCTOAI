# AI 기반 장기요양 평가 보고서 생성기: 통합 개발 문서 (핵심 정리)

## 프로젝트 개요
- PDF 장기요양 기록/법령 자료를 AI로 분석, 평가 기준에 맞는 자동 보고서 생성
- PC용 GUI, 네트워크 공유폴더(UNC) 지원, 대화형 프롬프트, 병렬 분석, 개인정보 마스킹

## 주요 기술/구조
- Python 3.8+, Tkinter/PyQt5, PyInstaller, PyMuPDF, transformers, matplotlib, pandas
- 폴더 구조: main.py, ui_app.py, data_processor.py, model_manager.py, report_generator.py, chat_interface.py, models/, data/, reports/
- 모든 PDF 자동 탐색/분석, 어르신별 폴더명 마스킹(예: 김*수), 파일명 자유

## 데이터 점검 기간 (핵심 조건)
- **시작일:** 입소일과 평가시작일 중 더 최근일
- **종료일:** 퇴소일이 있으면 퇴소일과 전일(어제) 중 더 과거 날짜, 없으면 전일(어제)
- **예시:** 입소일 2024-01-10, 평가시작일 2024-02-01, 퇴소일 2025-07-15, 오늘 2025-08-28 → 점검기간 2024-02-01 ~ 2025-07-15
- **코드 예시:**
  ```python
  from datetime import datetime, timedelta
  def get_period_start(입소일, 평가시작일):
      입소 = datetime.strptime(입소일, "%Y-%m-%d")
      평가 = datetime.strptime(평가시작일, "%Y-%m-%d")
      return max(입소, 평가)
  def get_period_end(퇴소일=None):
      today = datetime.today()
      전일 = today.replace(hour=0, minute=0, second=0, microsecond=0) - timedelta(days=1)
      if 퇴소일:
          퇴소 = datetime.strptime(퇴소일, "%Y-%m-%d")
          return min(전일, 퇴소)
      return 전일
  def is_in_period(date_str, 입소일, 평가시작일, 퇴소일=None):
      date = datetime.strptime(date_str, "%Y-%m-%d")
      start = get_period_start(입소일, 평가시작일)
      end = get_period_end(퇴소일)
      return start <= date <= end
  ```

## 보고서 필수 항목
1. **기본 정보:** 성명(마스킹), 생년월일, 성별, 입소일, 퇴소일(퇴소 시), 평가기간, 시설명
2. **기록 요약/평가지표별 등급:** 각 항목별 '우수/양호/불량/해당없음' 등급과 이유
3. **교차점검 결과:** 법령/지침 기준 누락, 감점 예상, 개선 권고
4. **시각화:** 그래프, 누락/감점 하이라이트
5. **AI 분석 요약:** 자동 평가 결과, 문제점, 개선점, 예상 점수
6. **질문/답변 기록(선택):** 대화형 기능 주요 Q&A
7. **첨부/참고자료:** 관련 법령, 지침, 참고 문서 링크/요약

## 개인정보 마스킹 예시
```python
def mask_name(name):
  if len(name) == 3:
    return name[0] + '*' + name[2]
  return name
def mask_id(id_number):
  return id_number[:7] + '*' * (len(id_number) - 7)
```

## 병렬 PDF 분석/오류 처리
- `concurrent.futures`/`multiprocessing`으로 병렬 처리, 오류 파일 개별 표시
- 진행상황 실시간 표시, 오류 즉시 알림/재시도 옵션

## 네트워크/공유폴더/PC 사양
- UNC 경로 지원, 네트워크 공유폴더 탐색/분석 가능
- 운영체제: Windows 10+, CPU 4코어+, RAM 8GB+(권장 16GB), SSD 50GB+, GPU(선택)
- 파일 공유만으로 서버 성능 직접 활용 불가, 서버-클라이언트 구조 필요

## GitHub 협업/버전관리
- 모든 작업 커밋/푸시, 변경사항 요약 메시지, 최신 내용 pull

## 평가지표-법령/지침-감점사유 매핑(JSON 예시)
```json
{
  "시설요양": {
    "평가지표1": {
      "법령": "고시 제75조의2",
      "지침": "장기요양급여 제공지침 2025",
      "감점사유": "체중 변화 기록 누락 시 감점"
    }
  }
}
```

# AI 기반 장기요양 평가 보고서 생성기: 통합 개발 문서

## 프로젝트 개요 및 목표
- **프로젝트명:** AI 기반 장기요양 평가 보고서 생성기
- **목표:** PDF 형태의 장기요양 기록 및 법령 자료를 AI로 분석하여, 어르신별 기록을 평가 기준에 맞게 자동 보고서로 생성하는 GUI 애플리케이션 개발

## 주요 기능 및 기술 스택
- PC용 GUI 애플리케이션(사무실 네트워크 공유 지원)
- Hugging Face 모델 파인튜닝
- 멀티프로세스/멀티스레드 대용량 분석
- 교차점검 및 자동 보고서 생성
- 대화형 프롬프트 기능(질문/답변)
- Python, Tkinter/PyQt5, PyInstaller, PyMuPDF, transformers, matplotlib, pandas

## 프로젝트 파일 구조 및 실무 정의
작업 디렉토리: `c:\python\LTCTOAI`
```
/LTCTOAI/
├── main.py              # 프로그램 실행 및 전체 흐름 제어
├── ui_app.py            # 사용자 인터페이스
├── data_processor.py    # PDF 읽기/추출/구조화
├── model_manager.py     # AI 모델 관리/파인튜닝
├── report_generator.py  # 보고서 생성/시각화
├── chat_interface.py    # 장기요양업무 및 보고서 관련 질문 기능
├── requirements.txt     # 라이브러리 목록
├── models/              # 모델 저장
├── data/
│   ├── common_docs/     # 공통 자료
│   └── patient_docs/    # 어르신별 자료
└── reports/             # 보고서 저장
```

## 폴더/파일 관리 권장사항
- 모든 PDF 파일은 폴더 내 자동 탐색/분석
- 어르신별 폴더명은 마스킹 적용(예: 김*수)
- PDF 파일명은 자료에 따라 자유롭게 입력, 프로그램에서 전체 파일 처리

## 환경설정 및 실행 예시
1. 가상환경 생성: `python -m venv venv`
2. 가상환경 활성화(Windows): `.\venv\Scripts\activate`
3. 라이브러리 설치: `pip install -r requirements.txt`
4. 프로그램 실행: `python main.py`

## 테스트/품질관리 (pytest)
- 테스트 파일은 `tests/` 폴더에 저장 (예: `tests/test_data_processor.py`)
- 테스트 함수 예시:
  ```python
  def test_extract_text_from_pdf():
    result = extract_text_from_pdf("샘플.pdf")
    assert isinstance(result, str)
  ```
- 실행: `pytest`

## 개인정보 마스킹 함수 예시
```python
def mask_name(name):
  if len(name) == 3:
    return name[0] + '*' + name[2]
  return name

def mask_id(id_number):
  return id_number[:7] + '*' * (len(id_number) - 7)
```

## 모델 관리 및 보고서 저장
- 보고서 파일은 `reports/` 폴더에 자동 저장
- 모델은 실행 시 기존 모델을 불러와 추가 학습(업그레이드)
- 모델 파일은 `models/` 폴더에 저장

## GitHub 버전관리 및 협업
- 모든 작업은 GitHub 저장소에 커밋/푸시하여 백업 및 버전관리
- 변경사항 저장: `git add .` → `git commit -m "작업 내용"` → `git push`
- 최신 내용 받기: `git pull`
- 커밋 메시지는 작업 내용을 간단히 요약

## 단계별 개발 및 기능 설명
### 1단계: 환경 설정 및 UI/UX 개발
- 가상 환경 및 라이브러리 설치
- GUI 메인 윈도우 구현(제목, 폴더 선택, 전문가 영역, 진행바, 결과 출력)
- 네트워크 경로 처리(UNC 지원)
- 실행 파일 생성(PyInstaller)

### 2단계: 데이터 처리 및 모델 관리
- PDF 텍스트 추출 함수: `extract_text_from_pdf(pdf_path)`
- 공통 자료/어르신별 자료 구조화
- **데이터 점검 기간:** 입소일과 평가시작일 중 더 최근 날짜부터 '전일(어제)'과 '퇴소일' 중 더 과거 날짜까지의 기록만 점검
  - 점검 종료일: 오늘의 전날(어제)과 퇴소일 중 더 과거 날짜
  - 퇴소일이 없는 경우에는 전일(어제)까지 점검
  - 예시: 입소일 2024-01-10, 평가시작일 2024-02-01, 퇴소일 2025-07-15, 오늘 2025-08-28 → 점검기간 2024-02-01 ~ 2025-07-15
  - 코드 예시:
    ```python
    from datetime import datetime, timedelta
    def get_period_start(입소일, 평가시작일):
        입소 = datetime.strptime(입소일, "%Y-%m-%d")
        평가 = datetime.strptime(평가시작일, "%Y-%m-%d")
        return max(입소, 평가)
    def get_period_end(퇴소일=None):
        today = datetime.today()
        전일 = today.replace(hour=0, minute=0, second=0, microsecond=0) - timedelta(days=1)
        if 퇴소일:
            퇴소 = datetime.strptime(퇴소일, "%Y-%m-%d")
            return min(전일, 퇴소)
        return 전일
    def is_in_period(date_str, 입소일, 평가시작일, 퇴소일=None):
        date = datetime.strptime(date_str, "%Y-%m-%d")
        start = get_period_start(입소일, 평가시작일)
        end = get_period_end(퇴소일)
        return start <= date <= end
    ```
- AI 모델 로드 및 파인튜닝
- 추가 학습 기능

### 3단계: 분석 로직 및 보고서 생성
- 멀티스레드/멀티프로세스 방식으로 개별 분석 및 기록 교차점검(단일 PC 내 병렬 처리)
- 결과 통합
- 보고서 콘텐츠 생성(matplotlib 그래프, 누락/감점 항목 명확화)
- PDF 보고서 출력(fpdf/reportlab)
- 평가지표별로 '우수/양호/불량/해당없음' 등급을 산출하여 각 항목별로 등급과 그 이유를 명확히 보고서에 표시
  - 예시:
    - 평가지표 30번: 현장지표 (해당없음)
    - 체중 변화 기록: 우수 (매월 기록 누락 없음)
    - 프로그램 참여 서명: 불량 (3회 이상 누락)
    - 투약 기록: 양호 (1회 누락, 경미)
  - 보고서 점검 기간은 항상 '입소일과 평가시작일 중 최근일'부터 '전일(어제)'과 '퇴소일' 중 더 과거 날짜까지로 설정하며, 평가 직전뿐 아니라 평상시에도 검토 가능하도록 설계

#### 보고서 구성 예시 및 필수 항목
1. **기본 정보**
   - 어르신 성명(마스킹), 생년월일, 성별, 입소일, 퇴소일(퇴소 시) 등
   - 평가 대상 기간, 시설명 등
2. **기록 요약 및 평가지표별 등급**
   - 주요 기록 항목별 요약
   - 각 평가지표별로 '우수/양호/불량/해당없음' 등급과 그 이유
3. **교차점검 결과**
   - 법령/지침 기준에 따른 필수 기록 누락 여부
   - 감점 예상 항목 및 사유
   - 개선 필요 사항 및 권고
4. **시각화**
   - matplotlib 등으로 생성한 그래프
   - 누락/감점 항목 하이라이트
5. **AI 분석 요약**
   - AI가 자동으로 분석한 평가 결과 요약
   - 주요 문제점, 개선점, 예상 점수 등
6. **질문/답변 기록(선택)**
   - 대화형 기능을 통해 나온 주요 질문과 답변 요약
7. **첨부/참고자료**
   - 관련 법령, 지침, 참고 문서 링크 또는 요약

### 4단계: 대화형 프롬프트 기능
- 질문 처리 및 답변 생성(공통 지식, 분석 결과 기반)
- 답변 출력(GUI 결과 영역)

## 영역별 평가지표-법령/지침-감점사유 매핑 구조 예시 (JSON)
```json
{
  "시설요양": {
    "평가지표1": {
      "법령": "고시 제75조의2",
      "지침": "장기요양급여 제공지침 2025",
      "감점사유": "체중 변화 기록 누락 시 감점"
    },
    "평가지표2": {
      "법령": "고시 제80조",
      "지침": "프로그램 참여 지침",
      "감점사유": "프로그램 서명 누락 시 감점"
    }
  },
  "주간보호": {
    "평가지표1": {
      "법령": "고시 제75조의2",
      "지침": "주간보호 급여지침",
      "감점사유": "체중 변화 기록 누락 시 감점"
    }
  },
  "방문요양": {
    "평가지표3": {
      "법령": "고시 제90조",
      "지침": "방문요양 서비스 지침",
      "감점사유": "방문기록 누락 시 감점"
    }
  }
}
```

## PDF 대량 분석을 위한 실무 전략
1. **속도 향상: 병렬 처리(멀티프로세스/멀티스레드)**
   - Python의 `concurrent.futures` 또는 `multiprocessing`을 사용해 여러 PDF를 동시에 처리
   - 예시 코드:
     ```python
     from concurrent.futures import ProcessPoolExecutor, as_completed

     def analyze_pdf(pdf_path):
         try:
             # PDF 분석 코드
             result = ...
             return pdf_path, result, None
         except Exception as e:
             return pdf_path, None, str(e)

     pdf_files = [...]  # PDF 파일 리스트
     results = []
     errors = []
     with ProcessPoolExecutor() as executor:
         futures = [executor.submit(analyze_pdf, f) for f in pdf_files]
         for future in as_completed(futures):
             pdf_path, result, error = future.result()
             if error:
                 errors.append((pdf_path, error))
             else:
                 results.append((pdf_path, result))
     ```

2. **데이터 점검 기간(최신 조건 반영):**
   - 입소일과 평가시작일 중 더 최근 날짜부터 '전일(어제)'과 '퇴소일' 중 더 과거 날짜까지의 기록만 점검
   - 예시 코드:
     ```python
     from datetime import datetime, timedelta

     def get_period_start(입소일, 평가시작일):
         입소 = datetime.strptime(입소일, "%Y-%m-%d")
         평가 = datetime.strptime(평가시작일, "%Y-%m-%d")
         return max(입소, 평가)

     def get_period_end(퇴소일=None):
         today = datetime.today()
         전일 = today.replace(hour=0, minute=0, second=0, microsecond=0) - timedelta(days=1)
         if 퇴소일:
             퇴소 = datetime.strptime(퇴소일, "%Y-%m-%d")
             return min(전일, 퇴소)
         return 전일

     def is_in_period(date_str, 입소일, 평가시작일, 퇴소일=None):
         date = datetime.strptime(date_str, "%Y-%m-%d")
         start = get_period_start(입소일, 평가시작일)
         end = get_period_end(퇴소일)
         return start <= date <= end
     ```

3. **정교한 내용 분석**
   - PDF 추출 시 텍스트 위치, 표, 이미지 등 다양한 요소를 파악
   - 멀티스레드/멀티프로세스 방식으로 개별 분석 및 기록 교차점검(단일 PC 내 병렬 처리)
   - 결과 통합
   - 보고서 콘텐츠 생성(matplotlib 그래프, 누락/감점 항목 명확화)
   - PDF 보고서 출력(fpdf/reportlab)
   - 평가지표별로 '우수/양호/불량/해당없음' 등급을 산출하여 각 항목별로 등급과 그 이유를 명확히 보고서에 표시
     - 예시:
       - 평가지표 30번: 현장지표 (해당없음)
       - 체중 변화 기록: 우수 (매월 기록 누락 없음)
       - 프로그램 참여 서명: 불량 (3회 이상 누락)
       - 투약 기록: 양호 (1회 누락, 경미)
   - 보고서 점검 기간은 항상 '입소일과 평가시작일 중 최근일'부터 '전일(어제)'과 '퇴소일' 중 더 과거 날짜까지로 설정하며, 평가 직전뿐 아니라 평상시에도 검토 가능하도록 설계
- 운영체제: Windows 10 이상(64비트)
- CPU: 4코어 이상
- RAM: 8GB 이상(권장 16GB)
- 저장공간: SSD 50GB 이상
- GPU: AI 모델 파인튜닝 시 NVIDIA GTX 1050 이상(없어도 가능)
- Python 3.8 이상
- 네트워크 환경: 유선 LAN(기가비트) 권장

## 네트워크/공유폴더 관련
- 공유폴더 PC는 파일 저장/전송만 담당, 일반 사무용 PC로 충분
- 실제 프로그램 실행은 사용자 PC의 사양이 더 중요
- 파일 공유만으로는 서버 성능을 직접 활용할 수 없으며, 서버-클라이언트 구조(원격 실행)로 설계해야 서버 성능을 활용 가능
